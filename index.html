<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Save the Date</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700&family=Spectral:wght@400;600&display=swap" rel="stylesheet">
    <link rel="icon" type="image/png" href="assets/favicon.png">
    <link rel="stylesheet" href="assets/css/bordered-gallery.css">
</head>
<body>
  <div
    class="countdown-overlay start-prompt"
    id="startOverlay"
    role="button"
    tabindex="0"
    aria-label="Start the countdown"
  >
    <div class="countdown-overlay-content">
      <span class="countdown-overlay-line countdown-overlay-line--top">get ready</span>
      <button class="countdown-overlay-button" id="startCountdownButton" type="button">click here</button>
      <span class="countdown-overlay-line countdown-overlay-line--bottom">to party</span>
    </div>
  </div>
  <div class="page-border">
    <div class="border-cell top-left-wide" data-reveal-index="1"><img src="assets/images/AUG4710_bw.jpg" alt="Couple laughing together"></div>
    <div class="border-cell top-center" data-reveal-index="2"><img src="assets/images/AUG4726_bw.jpg" alt="Holding hands"></div>
    <div class="border-cell top-right" data-reveal-index="3"><img src="assets/images/AUG4759_bw.jpg" alt="Sharing a quiet moment together"></div>

    <div class="border-cell middle-left-tall" data-reveal-index="4"><img src="assets/images/AUG4849_bw.jpg" alt="Walking through the forest"></div>
    <div class="card-shell" id="cardShell">
      <div class="countdown-wrapper" aria-live="polite">
        <p class="eyebrow">Celebration Countdown</p>
        <div class="countdown-number" id="countdownNumber" role="status" aria-label="Countdown starting">10</div>
        <p class="countdown-note">Counting down the final moments until the big day.</p>
      </div>
    </div>
    <div class="border-cell right-tall" data-reveal-index="5"><img src="assets/images/AUG5177_bw.jpg" alt="Laughing in the field"></div>

    <div class="border-cell bottom-left" data-reveal-index="6"><img src="assets/images/AUG5106_bw.jpg" alt="Smiling under the trees"></div>
    <div class="border-cell bottom-wide" data-reveal-index="7"><img src="assets/images/AUG5127_bw.jpg" alt="Holding close"></div>
    <div class="border-cell bottom-right" data-reveal-index="8"><img src="assets/images/AUG5201_bw.jpg" alt="Strolling along the shoreline"></div>
  </div>
  <div class="mobile-experience" id="mobileExperience" aria-live="polite" aria-label="Slideshow of our memories">
    <div class="mobile-stage" id="mobileStage"></div>
  </div>
  <script>
    (() => {
      'use strict';

      // Configuration constants that define animation timing and interaction behavior.
      const KEYBOARD_ACTIVATION_KEYS = new Set(['Enter', ' ', 'Spacebar']);
      const CELEBRATION_CONFETTI_PIECES = 80;
      const CELEBRATION_CONFETTI_COLORS = ['#03281c', '#000000', '#ffffff'];
      const CELEBRATION_CONFETTI_LIFETIME_MS = 4200;
      const CELEBRATION_TRANSITION_DELAY_MS = 520;
      const VIDEO_COMPLETE_DELAY_MS = 600;
      const COUNTDOWN_INTERVAL_MS = 1100;
      const COUNTDOWN_COMPLETE_VIDEO_DELAY_MS = 400;
      const COUNTDOWN_TRANSITION_RESET_MS = 360;
      const START_OVERLAY_CLEAR_DELAY_MS = 420;
      const SAVE_THE_DATE_REVEAL_DELAY_MS = 80;
      const COUNTDOWN_START_FALLBACK = 10;
      const MOBILE_PHOTO_DEFAULT_DURATION_MS = 1600;
      const MOBILE_PHOTO_CYCLE_DURATIONS = [
        { start: 2000, step: 140, min: 1200 },
        { start: 1100, step: 160, min: 420 },
      ];
      const VENUE_SNEAK_PEEK_VIDEO_SOURCE = 'assets/ChaletView480.mp4';

      // Media state --------------------------------------------------------
      let sharedCelebrationVideoElement = null;
      let sharedCelebrationVideoEndedHandler = null;
      let sharedCelebrationVideoErrorHandler = null;
      let hasPrimedMobileVideoPlayback = false;

      const createCelebrationVideoElement = () => {
        const video = document.createElement('video');
        video.className = 'countdown-video';
        video.src = 'assets/video.mp4';
        video.preload = 'auto';
        video.autoplay = true;
        video.muted = false;
        video.controls = true;
        video.setAttribute('playsinline', '');
        return video;
      };

      const getCelebrationVideoElement = () => {
        if (!sharedCelebrationVideoElement) {
          sharedCelebrationVideoElement = createCelebrationVideoElement();
        }

        return sharedCelebrationVideoElement;
      };

      const resetCelebrationVideoHandlers = (video) => {
        if (!video) {
          return;
        }

        if (sharedCelebrationVideoEndedHandler) {
          video.removeEventListener('ended', sharedCelebrationVideoEndedHandler);
          sharedCelebrationVideoEndedHandler = null;
        }

        if (sharedCelebrationVideoErrorHandler) {
          video.removeEventListener('error', sharedCelebrationVideoErrorHandler);
          sharedCelebrationVideoErrorHandler = null;
        }
      };

      const attachCelebrationVideoHandlers = (video, { onEnded, onError }) => {
        if (!video) {
          return;
        }

        resetCelebrationVideoHandlers(video);

        if (typeof onEnded === 'function') {
          sharedCelebrationVideoEndedHandler = onEnded;
          video.addEventListener('ended', sharedCelebrationVideoEndedHandler, { once: true });
        }

        if (typeof onError === 'function') {
          sharedCelebrationVideoErrorHandler = onError;
          video.addEventListener('error', sharedCelebrationVideoErrorHandler, { once: true });
        }
      };

      const primeMobileCelebrationVideoPlayback = () => {
        if (hasPrimedMobileVideoPlayback) {
          return;
        }

        const video = getCelebrationVideoElement();
        if (!video) {
          return;
        }

        if (!video.paused && !video.ended) {
          return;
        }

        const body = document.body;
        if (!body) {
          return;
        }

        const primerContainer = document.createElement('div');
        primerContainer.style.position = 'fixed';
        primerContainer.style.width = '1px';
        primerContainer.style.height = '1px';
        primerContainer.style.overflow = 'hidden';
        primerContainer.style.pointerEvents = 'none';
        primerContainer.style.opacity = '0';
        primerContainer.setAttribute('aria-hidden', 'true');

        primerContainer.appendChild(video);
        body.appendChild(primerContainer);

        const originalMuted = video.muted;
        video.muted = true;

        const finalizePrimer = (wasSuccessful) => {
          video.pause();
          video.currentTime = 0;
          video.muted = originalMuted;
          primerContainer.remove();

          if (wasSuccessful) {
            hasPrimedMobileVideoPlayback = true;
          }
        };

        const playPromise = video.play();
        if (playPromise && typeof playPromise.then === 'function') {
          playPromise.then(() => {
            finalizePrimer(true);
          }).catch(() => {
            finalizePrimer(false);
          });
        } else {
          finalizePrimer(true);
        }
      };

      // Audio helpers ------------------------------------------------------
      const AudioContextConstructor = window.AudioContext || window.webkitAudioContext;
      let audioCtx = null;

      const getAudioContext = () => {
        if (!AudioContextConstructor) {
          return null;
        }

        if (!audioCtx) {
          try {
            audioCtx = new AudioContextConstructor();
          } catch (error) {
            audioCtx = null;
            return null;
          }
        }

        return audioCtx;
      };

      const resumeContextIfSuspended = (context) => {
        if (context?.state === 'suspended') {
          context.resume().catch(() => {});
        }
      };

      const playBeat = () => {
        const context = getAudioContext();
        if (!context) {
          return;
        }

        resumeContextIfSuspended(context);

        const oscillator = context.createOscillator();
        const gain = context.createGain();
        oscillator.type = 'sine';
        oscillator.frequency.setValueAtTime(82, context.currentTime);
        oscillator.connect(gain);
        gain.connect(context.destination);

        const now = context.currentTime;
        gain.gain.setValueAtTime(0, now);
        gain.gain.linearRampToValueAtTime(1.3, now + 0.012);
        gain.gain.exponentialRampToValueAtTime(0.001, now + 0.34);
        oscillator.start(now);
        oscillator.stop(now + 0.34);
      };

      const playBoom = () => {
        const context = getAudioContext();
        if (!context) {
          return;
        }

        resumeContextIfSuspended(context);

        const now = context.currentTime;
        const duration = 0.82;

        const toneOscillator = context.createOscillator();
        const toneGain = context.createGain();
        toneOscillator.type = 'sine';
        toneOscillator.frequency.setValueAtTime(180, now);
        toneOscillator.frequency.exponentialRampToValueAtTime(52, now + duration);
        toneGain.gain.setValueAtTime(0.0001, now);
        toneGain.gain.exponentialRampToValueAtTime(1.1, now + 0.02);
        toneGain.gain.exponentialRampToValueAtTime(0.0001, now + duration);
        toneOscillator.connect(toneGain);
        toneGain.connect(context.destination);

        toneOscillator.start(now);
        toneOscillator.stop(now + duration);

        const noiseBuffer = context.createBuffer(1, Math.ceil(context.sampleRate * duration), context.sampleRate);
        const noiseChannelData = noiseBuffer.getChannelData(0);
        for (let index = 0; index < noiseChannelData.length; index += 1) {
          const decay = 1 - index / noiseChannelData.length;
          noiseChannelData[index] = (Math.random() * 2 - 1) * decay * decay;
        }

        const noiseSource = context.createBufferSource();
        noiseSource.buffer = noiseBuffer;
        const noiseGain = context.createGain();
        noiseGain.gain.setValueAtTime(0.5, now);
        noiseGain.gain.exponentialRampToValueAtTime(0.0001, now + duration);
        noiseSource.connect(noiseGain);
        noiseGain.connect(context.destination);

        noiseSource.start(now);
        noiseSource.stop(now + duration);
      };

      // Motion preferences -------------------------------------------------
      const prefersReducedMotionQuery = typeof window.matchMedia === 'function'
        ? window.matchMedia('(prefers-reduced-motion: reduce)')
        : null;
      const prefersReducedMotion = prefersReducedMotionQuery?.matches ?? false;

      // Celebration visuals -----------------------------------------------
      const launchConfetti = () => {
        if (prefersReducedMotion || !document.body) {
          return;
        }

        const confettiContainer = document.createElement('div');
        confettiContainer.className = 'confetti-container';

        for (let index = 0; index < CELEBRATION_CONFETTI_PIECES; index += 1) {
          const piece = document.createElement('span');
          piece.className = 'confetti-piece';
          piece.style.setProperty('--confetti-left', `${Math.random() * 100}%`);
          piece.style.setProperty('--confetti-delay', `${Math.random() * 0.45}s`);
          piece.style.setProperty('--confetti-duration', `${2.6 + Math.random()}s`);
          piece.style.setProperty('--confetti-drift', `${Math.random() * 120 - 60}px`);
          piece.style.backgroundColor = CELEBRATION_CONFETTI_COLORS[index % CELEBRATION_CONFETTI_COLORS.length];
          confettiContainer.appendChild(piece);
        }

        document.body.appendChild(confettiContainer);
        window.setTimeout(() => {
          confettiContainer.remove();
        }, CELEBRATION_CONFETTI_LIFETIME_MS);
      };

      // Layout references -------------------------------------------------
      const borderCells = Array.from(document.querySelectorAll('.border-cell')).sort((first, second) => {
        const firstIndex = Number(first.dataset.revealIndex) || 0;
        const secondIndex = Number(second.dataset.revealIndex) || 0;
        return firstIndex - secondIndex;
      });

      if (prefersReducedMotion) {
        borderCells.forEach((cell) => {
          cell.classList.add('is-visible');
        });
      }

      const mobileStage = document.getElementById('mobileStage');
      const mobileBreakpointQuery = typeof window.matchMedia === 'function'
        ? window.matchMedia('(max-width: 640px), (max-height: 520px)')
        : null;
      let isMobileExperienceActive = mobileBreakpointQuery?.matches ?? false;

      const updateMobileExperiencePreference = (event) => {
        if (typeof event?.matches === 'boolean') {
          isMobileExperienceActive = event.matches;
        } else if (mobileBreakpointQuery) {
          isMobileExperienceActive = mobileBreakpointQuery.matches;
        }
      };

      if (mobileBreakpointQuery) {
        if (typeof mobileBreakpointQuery.addEventListener === 'function') {
          mobileBreakpointQuery.addEventListener('change', updateMobileExperiencePreference);
        } else if (typeof mobileBreakpointQuery.addListener === 'function') {
          mobileBreakpointQuery.addListener(updateMobileExperiencePreference);
        }
      }

      // Mobile photo data -------------------------------------------------
      const mobilePhotoDetails = borderCells.map((cell) => {
        const cellImage = cell.querySelector('img');
        return {
          src: cellImage?.getAttribute('src') ?? '',
          alt: cellImage?.getAttribute('alt') ?? '',
        };
      });
      const mobilePhotoLoopCount = prefersReducedMotion ? 1 : 2;

      const getMobilePhotoDisplayDuration = ({ cycleIndex, photoIndex }) => {
        if (prefersReducedMotion) {
          return MOBILE_PHOTO_DEFAULT_DURATION_MS;
        }

        const settings = MOBILE_PHOTO_CYCLE_DURATIONS[cycleIndex]
          ?? MOBILE_PHOTO_CYCLE_DURATIONS[MOBILE_PHOTO_CYCLE_DURATIONS.length - 1];
        const duration = settings.start - settings.step * photoIndex;
        return Math.max(settings.min, duration);
      };

      // Countdown state ---------------------------------------------------
      const cardShell = document.getElementById('cardShell');
      const initialCountdownWrapper = cardShell?.querySelector('.countdown-wrapper');
      const countdownNumber = document.getElementById('countdownNumber');
      const countdownNote = initialCountdownWrapper?.querySelector('.countdown-note');
      const countdownStart = borderCells.length > 0 ? borderCells.length : COUNTDOWN_START_FALLBACK;
      let currentValue = countdownStart;
      let revealedCells = 0;
      let countdownIntervalId = null;
      let hasStarted = false;
      let tearDownOrientationPrompt = null;

      // Orientation prompts -----------------------------------------------
      const clearOrientationPrompt = () => {
        if (typeof tearDownOrientationPrompt === 'function') {
          tearDownOrientationPrompt();
          tearDownOrientationPrompt = null;
        }
      };

      const setupOrientationPrompt = ({ container, video }) => {
        if (!container || !video) {
          return () => {};
        }

        const prompt = document.createElement('div');
        prompt.className = 'orientation-prompt';
        prompt.setAttribute('role', 'status');
        prompt.setAttribute('aria-live', 'polite');
        prompt.setAttribute('aria-hidden', 'true');

        const promptText = document.createElement('span');
        promptText.className = 'orientation-prompt__text';
        promptText.textContent = 'Rotate your device to watch in full screen';

        prompt.appendChild(promptText);
        container.appendChild(prompt);

        const updatePromptVisibility = () => {
          const viewportWidth = window.innerWidth || 0;
          const viewportHeight = window.innerHeight || 0;
          const isViewportPortrait = viewportHeight > viewportWidth;
          const hasMetadata = video.videoWidth > 0 && video.videoHeight > 0;
          const isVideoLandscape = hasMetadata ? video.videoWidth >= video.videoHeight : false;

          if (isViewportPortrait && isVideoLandscape) {
            prompt.classList.add('is-visible');
            prompt.setAttribute('aria-hidden', 'false');
          } else {
            prompt.classList.remove('is-visible');
            prompt.setAttribute('aria-hidden', 'true');
          }
        };

        const handleLoadedMetadata = () => {
          updatePromptVisibility();
        };

        video.addEventListener('loadedmetadata', handleLoadedMetadata);
        window.addEventListener('resize', updatePromptVisibility);
        window.addEventListener('orientationchange', updatePromptVisibility);

        window.setTimeout(updatePromptVisibility, 0);

        return () => {
          prompt.remove();
          video.removeEventListener('loadedmetadata', handleLoadedMetadata);
          window.removeEventListener('resize', updatePromptVisibility);
          window.removeEventListener('orientationchange', updatePromptVisibility);
        };
      };

      const applyOrientationPrompt = ({ container, video }) => {
        clearOrientationPrompt();
        tearDownOrientationPrompt = setupOrientationPrompt({ container, video });
      };

      // Overlay controls --------------------------------------------------
      const startOverlay = document.getElementById('startOverlay');
      const startOverlayContent = startOverlay?.querySelector('.countdown-overlay-content') ?? null;
      const startButton = document.getElementById('startCountdownButton');

      const revealNextBorderCell = () => {
        if (prefersReducedMotion || isMobileExperienceActive) {
          return;
        }

        const nextCell = borderCells[revealedCells];
        if (nextCell) {
          nextCell.classList.add('is-visible');
          revealedCells += 1;
        }
      };

      // Save-the-date builders -------------------------------------------
      const createSaveTheDateActionButton = ({
        label,
        iconPath,
        additionalClassName = '',
        viewBox = '0 0 24 24',
        element = 'button',
        href = '',
      }) => {
        const tagName = element === 'a' ? 'a' : 'button';
        const button = document.createElement(tagName);
        if (tagName === 'button') {
          button.type = 'button';
        } else if (href) {
          button.href = href;
          button.target = '_blank';
          button.rel = 'noopener noreferrer';
        } else {
          button.href = '#';
        }
        button.className = `save-date-action${
          additionalClassName ? ` ${additionalClassName}` : ''
        }`;

        const icon = document.createElement('span');
        icon.className = 'save-date-action__icon';

        const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
        svg.setAttribute('viewBox', viewBox);
        svg.setAttribute('aria-hidden', 'true');
        svg.classList.add('save-date-action__icon-graphic');

        const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
        path.setAttribute('d', iconPath);
        path.setAttribute('fill', 'currentColor');

        svg.appendChild(path);
        icon.appendChild(svg);

        const labelEl = document.createElement('span');
        labelEl.className = 'save-date-action__label';
        labelEl.textContent = label;

        button.append(icon, labelEl);

        return button;
      };

      const buildSaveTheDateDetails = () => {
        const wrapper = document.createElement('div');
        wrapper.className = 'countdown-wrapper has-details';

        const eyebrow = document.createElement('p');
        eyebrow.className = 'eyebrow';
        eyebrow.textContent = 'Save the Date';

        const title = document.createElement('h1');
        title.className = 'save-date-title';
        const firstName = document.createElement('span');
        firstName.className = 'save-date-name';
        firstName.textContent = 'Lorraine';

        const ampersand = document.createElement('span');
        ampersand.className = 'save-date-amp';
        ampersand.textContent = '&';

        const secondName = document.createElement('span');
        secondName.className = 'save-date-name';
        secondName.textContent = 'Christopher';

        title.append(firstName, ampersand, secondName);

        const dateLine = document.createElement('p');
        dateLine.className = 'save-date-date';
        const dateMain = document.createElement('span');
        dateMain.className = 'save-date-date-main';
        dateMain.textContent = 'September 12, 2026';

        const dateLocation = document.createElement('span');
        dateLocation.className = 'save-date-date-location';
        dateLocation.textContent = 'Portola, California';

        dateLine.append(dateMain, dateLocation);

        const note = document.createElement('p');
        note.className = 'countdown-note save-date-note';
        note.textContent = 'Formal invite to follow';

        const actions = document.createElement('div');
        actions.className = 'save-date-actions';

        const websiteLink = createSaveTheDateActionButton({
          label: 'Wedding website',
          iconPath: 'M12 4a4 4 0 0 1 4 4v1h1a3 3 0 0 1 3 3v6a3 3 0 0 1-3 3H8a3 3 0 0 1-3-3v-6a3 3 0 0 1 3-3h1V8a4 4 0 0 1 4-4zm0 2a2 2 0 0 0-2 2v1h4V8a2 2 0 0 0-2-2zm5 5H8a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-6a1 1 0 0 0-1-1z',
          element: 'a',
          href: 'https://becomingcummings.love',
        });
        websiteLink.setAttribute('aria-label', 'Visit our wedding website (opens in a new tab)');

        const replayButton = createSaveTheDateActionButton({
          label: 'Replay celebration video',
          iconPath:
            'M12 5.5V2L5.5 8.5 12 15V10.6c3.15 0 5.9 2.55 5.9 5.9s-2.55 5.9-5.9 5.9-5.9-2.55-5.9-5.9h-2c0 4.36 3.54 7.9 7.9 7.9s7.9-3.54 7.9-7.9S16.36 8.6 12 8.6z',
        });
        replayButton.setAttribute('aria-label', 'Replay celebration video');

        const sneakPeekButton = createSaveTheDateActionButton({
          label: 'Venue sneak peek',
          iconPath: 'M8 5.5v13l11-6.5-11-6.5z',
          additionalClassName: 'save-date-action--secondary',
        });
        sneakPeekButton.setAttribute('aria-label', 'Play the venue sneak peek video');

        actions.append(websiteLink, replayButton, sneakPeekButton);

        wrapper.appendChild(eyebrow);
        wrapper.appendChild(title);
        wrapper.appendChild(dateLine);
        wrapper.appendChild(note);
        wrapper.appendChild(actions);

        return { wrapper, title, replayButton, sneakPeekButton, websiteLink };
      };

      const revealSaveTheDateDetails = ({ title }, { withCelebrateEffects = false } = {}) => {
        if (withCelebrateEffects && !prefersReducedMotion) {
          window.requestAnimationFrame(() => {
            title.classList.add('save-date-title--spiral');
          });

          window.setTimeout(() => {
            playBoom();
            launchConfetti();
          }, CELEBRATION_TRANSITION_DELAY_MS);
        }
      };

      const createBackToDetailsButton = () =>
        createSaveTheDateActionButton({
          label: 'Back to details',
          iconPath: 'M14.5 6.5 8.5 12l6 5.5V6.5z',
          additionalClassName: 'save-date-action--ghost save-date-back-button',
        });

      const wireSaveTheDateActions = (
        { replayButton, sneakPeekButton },
        { onReplay, onSneakPeek } = {}
      ) => {
        if (replayButton && typeof onReplay === 'function') {
          replayButton.addEventListener('click', onReplay);
        }

        if (sneakPeekButton && typeof onSneakPeek === 'function') {
          sneakPeekButton.addEventListener('click', onSneakPeek);
        }
      };

      const showSaveTheDateDetails = ({
        targetContainer = cardShell,
        withCelebrateEffects = false,
      } = {}) => {
        if (!targetContainer) {
          return;
        }

        const elements = buildSaveTheDateDetails();
        targetContainer.innerHTML = '';
        targetContainer.appendChild(elements.wrapper);
        wireSaveTheDateActions(elements, {
          onReplay: () => {
            showCelebrationVideo({ targetContainer, withCelebrateEffectsOnComplete: false });
          },
          onSneakPeek: () => {
            showSneakPeekVideo({ targetContainer });
          },
        });
        revealSaveTheDateDetails(elements, { withCelebrateEffects });
      };

      // Video helpers -----------------------------------------------------
      const buildCelebrationVideo = () => {
        const wrapper = document.createElement('div');
        wrapper.className = 'countdown-wrapper has-video';

        const videoHashtag = document.createElement('p');
        videoHashtag.className = 'video-hashtag';
        videoHashtag.textContent = '#BECOMINGCUMMINGS';

        const videoFrame = document.createElement('div');
        videoFrame.className = 'countdown-video-frame';

        const celebrationVideo = getCelebrationVideoElement();
        celebrationVideo.pause();
        celebrationVideo.currentTime = 0;
        celebrationVideo.muted = false;
        celebrationVideo.autoplay = true;
        celebrationVideo.controls = true;
        celebrationVideo.setAttribute('playsinline', '');

        videoFrame.appendChild(celebrationVideo);

        wrapper.appendChild(videoHashtag);
        wrapper.appendChild(videoFrame);

        return { wrapper, celebrationVideo };
      };

      const buildSneakPeekVideo = () => {
        const wrapper = document.createElement('div');
        wrapper.className = 'countdown-wrapper has-video sneak-peek-wrapper';

        const videoHashtag = document.createElement('p');
        videoHashtag.className = 'video-hashtag sneak-peek-hashtag';
        videoHashtag.textContent = 'Venue sneak peek';

        const videoFrame = document.createElement('div');
        videoFrame.className = 'countdown-video-frame sneak-peek-frame';

        const video = document.createElement('video');
        video.className = 'sneak-peek-embed';
        video.src = VENUE_SNEAK_PEEK_VIDEO_SOURCE;
        video.controls = true;
        video.preload = 'metadata';
        video.setAttribute('playsinline', '');
        video.setAttribute('aria-label', 'Sneak peek of the celebration venue');

        videoFrame.appendChild(video);

        const caption = document.createElement('p');
        caption.className = 'countdown-note sneak-peek-caption';
        caption.textContent = 'Take a quick tour of where we will celebrate together!';

        const backButton = createBackToDetailsButton();

        wrapper.appendChild(videoHashtag);
        wrapper.appendChild(videoFrame);
        wrapper.appendChild(caption);
        wrapper.appendChild(backButton);

        return { wrapper, video, backButton };
      };

      const safelyPlayVideo = (videoElement) => {
        if (!videoElement) {
          return;
        }

        const attemptVideoPlayback = () => {
          const playPromise = videoElement.play();
          if (playPromise && typeof playPromise.catch === 'function') {
            playPromise.catch(() => {});
          }
        };

        if (videoElement.readyState >= 2) {
          attemptVideoPlayback();
        } else {
          videoElement.addEventListener('canplay', attemptVideoPlayback, { once: true });
        }
      };

      const showCelebrationVideo = ({
        targetContainer = cardShell,
        onVideoEnded,
        onVideoError,
        withCelebrateEffectsOnComplete = true,
      } = {}) => {
        if (!targetContainer) {
          return;
        }

        clearOrientationPrompt();

        const { wrapper, celebrationVideo } = buildCelebrationVideo();
        targetContainer.innerHTML = '';
        targetContainer.appendChild(wrapper);

        const resolvedOnEnded = typeof onVideoEnded === 'function'
          ? onVideoEnded
          : () => {
              if (withCelebrateEffectsOnComplete) {
                showSaveTheDateDetails({ targetContainer, withCelebrateEffects: true });
              } else {
                showSaveTheDateDetails({ targetContainer });
              }
            };

        const resolvedOnError = typeof onVideoError === 'function'
          ? onVideoError
          : () => {
              showSaveTheDateDetails({ targetContainer });
            };

        attachCelebrationVideoHandlers(celebrationVideo, {
          onEnded: () => {
            window.setTimeout(resolvedOnEnded, VIDEO_COMPLETE_DELAY_MS);
          },
          onError: () => {
            resolvedOnError();
          },
        });

        safelyPlayVideo(celebrationVideo);
      };

      const showSneakPeekVideo = ({ targetContainer = cardShell } = {}) => {
        if (!targetContainer) {
          return;
        }

        clearOrientationPrompt();

        const { wrapper, video, backButton } = buildSneakPeekVideo();
        targetContainer.innerHTML = '';
        targetContainer.appendChild(wrapper);

        if (backButton) {
          backButton.addEventListener('click', () => {
            showSaveTheDateDetails({ targetContainer });
          });
        }

        if (video) {
          video.currentTime = 0;
        }
      };

      // Mobile experience helpers ----------------------------------------
      const createMobileFrame = (additionalClassName = '') => {
        const frame = document.createElement('div');
        frame.className = `mobile-frame${additionalClassName ? ` ${additionalClassName}` : ''}`;
        return frame;
      };

      const swapMobileFrame = (newFrame) => {
        if (!mobileStage) {
          return;
        }

        clearOrientationPrompt();

        const transitionDelay = prefersReducedMotion ? 0 : CELEBRATION_TRANSITION_DELAY_MS;
        const existingFrame = mobileStage.firstElementChild;

        const placeNewFrame = () => {
          mobileStage.replaceChildren(newFrame);
          if (prefersReducedMotion) {
            newFrame.classList.add('is-visible');
          } else {
            window.requestAnimationFrame(() => {
              newFrame.classList.add('is-visible');
            });
          }
        };

        if (existingFrame && !prefersReducedMotion) {
          existingFrame.classList.remove('is-visible');
          window.setTimeout(placeNewFrame, transitionDelay);
        } else {
          placeNewFrame();
        }
      };

      const showMobileSaveTheDate = ({ withCelebrateEffects = true } = {}) => {
        if (!mobileStage) {
          return;
        }

        const elements = buildSaveTheDateDetails();
        const frame = createMobileFrame('mobile-frame--card');
        frame.appendChild(elements.wrapper);

        swapMobileFrame(frame);

        wireSaveTheDateActions(elements, {
          onReplay: () => {
            showMobileVideo();
          },
          onSneakPeek: () => {
            showMobileSneakPeek();
          },
        });

        const reveal = () => {
          revealSaveTheDateDetails(elements, { withCelebrateEffects });
        };

        if (prefersReducedMotion) {
          reveal();
        } else {
          window.setTimeout(reveal, SAVE_THE_DATE_REVEAL_DELAY_MS);
        }
      };

      const showMobileVideo = () => {
        if (!mobileStage) {
          return;
        }

        const { wrapper, celebrationVideo } = buildCelebrationVideo();
        const frame = createMobileFrame('mobile-frame--video');
        frame.appendChild(wrapper);

        swapMobileFrame(frame);

        applyOrientationPrompt({ container: frame, video: celebrationVideo });

        attachCelebrationVideoHandlers(celebrationVideo, {
          onEnded: () => {
            window.setTimeout(() => {
              showMobileSaveTheDate({ withCelebrateEffects: true });
            }, VIDEO_COMPLETE_DELAY_MS);
          },
          onError: () => {
            showMobileSaveTheDate({ withCelebrateEffects: false });
          },
        });

        safelyPlayVideo(celebrationVideo);
      };

      const showMobileSneakPeek = () => {
        if (!mobileStage) {
          showSneakPeekVideo({ targetContainer: cardShell });
          return;
        }

        const { wrapper, video, backButton } = buildSneakPeekVideo();
        const frame = createMobileFrame('mobile-frame--video');
        frame.appendChild(wrapper);

        swapMobileFrame(frame);

        if (video) {
          video.currentTime = 0;
          applyOrientationPrompt({ container: frame, video });
        }

        if (backButton) {
          backButton.addEventListener('click', () => {
            showMobileSaveTheDate({ withCelebrateEffects: false });
          });
        }
      };

      const showMobilePhotoAtIndex = (index, cycleIndex = 0) => {
        if (!mobileStage) {
          return;
        }

        if (cycleIndex >= mobilePhotoLoopCount) {
          showMobileVideo();
          return;
        }

        if (index >= mobilePhotoDetails.length) {
          showMobilePhotoAtIndex(0, cycleIndex + 1);
          return;
        }

        const photoDetails = mobilePhotoDetails[index];
        if (!photoDetails || !photoDetails.src) {
          window.setTimeout(() => {
            showMobilePhotoAtIndex(index + 1, cycleIndex);
          }, 0);
          return;
        }

        const frame = createMobileFrame('mobile-frame--photo');
        const image = document.createElement('img');
        image.src = photoDetails.src;
        image.alt = photoDetails.alt || '';
        frame.appendChild(image);

        playBeat();
        swapMobileFrame(frame);

        const displayDuration = getMobilePhotoDisplayDuration({ cycleIndex, photoIndex: index });
        window.setTimeout(() => {
          showMobilePhotoAtIndex(index + 1, cycleIndex);
        }, displayDuration);
      };

      const startMobileSequence = () => {
        if (!mobileStage) {
          showCelebrationVideo({ targetContainer: cardShell });
          return;
        }

        if (mobilePhotoDetails.length === 0) {
          showMobileVideo();
          return;
        }

        showMobilePhotoAtIndex(0, 0);
      };

      // Countdown flow ----------------------------------------------------
      const handleCountdownTick = () => {
        if (!countdownNumber) {
          return;
        }

        currentValue -= 1;
        countdownNumber.classList.add('is-transitioning');
        playBeat();

        if (currentValue <= 0) {
          countdownNumber.textContent = '0';
          countdownNumber.setAttribute('aria-label', 'Countdown finished');
          window.clearInterval(countdownIntervalId);
          revealNextBorderCell();
          if (countdownNote) {
            countdownNote.textContent = 'Counting down the final moments until the big day.';
          }
          window.setTimeout(() => {
            showCelebrationVideo();
          }, COUNTDOWN_COMPLETE_VIDEO_DELAY_MS);
        } else {
          countdownNumber.textContent = String(currentValue);
          countdownNumber.setAttribute('aria-label', `Countdown at ${currentValue}`);
          revealNextBorderCell();
        }

        window.setTimeout(() => {
          countdownNumber.classList.remove('is-transitioning');
        }, COUNTDOWN_TRANSITION_RESET_MS);
      };

      const startCountdownFlow = () => {
        if (isMobileExperienceActive) {
          primeMobileCelebrationVideoPlayback();
          startMobileSequence();
          return;
        }

        if (!countdownNumber || !initialCountdownWrapper) {
          showCelebrationVideo();
          return;
        }

        countdownNumber.textContent = String(currentValue);
        countdownNumber.setAttribute('aria-label', `Countdown at ${currentValue}`);
        revealNextBorderCell();
        playBeat();
        countdownIntervalId = window.setInterval(handleCountdownTick, COUNTDOWN_INTERVAL_MS);
      };

      // Overlay lifecycle -------------------------------------------------
      const startExperience = () => {
        if (hasStarted) {
          return;
        }

        hasStarted = true;

        if (startOverlayContent) {
          startOverlayContent.classList.add('is-clearing');
        }

        if (startOverlay) {
          startOverlay.removeEventListener('click', startExperience);
          startOverlay.removeEventListener('keydown', handleOverlayKeyDown);
          startOverlay.classList.add('is-counting');
          window.setTimeout(() => {
            startOverlay.classList.add('hidden');
            startOverlay.setAttribute('aria-hidden', 'true');
            startOverlay.setAttribute('tabindex', '-1');
          }, START_OVERLAY_CLEAR_DELAY_MS);
        }

        if (startButton) {
          startButton.removeEventListener('click', startExperience);
          startButton.disabled = true;
          startButton.setAttribute('tabindex', '-1');
        }

        const context = getAudioContext();
        resumeContextIfSuspended(context);

        if (isMobileExperienceActive) {
          primeMobileCelebrationVideoPlayback();
          startMobileSequence();
        } else {
          startCountdownFlow();
        }
      };

      const handleOverlayKeyDown = (event) => {
        if (!event) {
          return;
        }

        if (KEYBOARD_ACTIVATION_KEYS.has(event.key)) {
          event.preventDefault();
          startExperience();
        }
      };

      // Wire up interactions ----------------------------------------------
      if (startButton) {
        startButton.addEventListener('click', startExperience);
      }

      if (startOverlay) {
        startOverlay.addEventListener('click', startExperience);
        startOverlay.addEventListener('keydown', handleOverlayKeyDown);
      }

      if (!startOverlay || !startButton) {
        startExperience();
      }
    })();
  </script>
</body>
</html>
