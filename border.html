<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Framed Memories</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700&family=Spectral:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="assets/css/bordered-gallery.css">
</head>
<body>
  <div
    class="countdown-overlay start-prompt"
    id="startOverlay"
    role="button"
    tabindex="0"
    aria-label="Start the countdown"
  >
    <div class="countdown-overlay-content">
      <span class="countdown-overlay-line countdown-overlay-line--top">get ready</span>
      <button class="countdown-overlay-button" id="startCountdownButton" type="button">click here</button>
      <span class="countdown-overlay-line countdown-overlay-line--bottom">to party</span>
    </div>
  </div>
  <div class="page-border">
    <div class="border-cell top-left" data-reveal-index="1"><img src="assets/images/AUG4710_bw.jpg" alt="Couple laughing together"></div>
    <div class="border-cell top-left-center" data-reveal-index="2"><img src="assets/images/AUG4726_bw.jpg" alt="Holding hands"></div>
    <div class="border-cell top-right-center" data-reveal-index="3"><img src="assets/images/AUG4738_bw.jpg" alt="Looking at each other"></div>
    <div class="border-cell top-right" data-reveal-index="4"><img src="assets/images/AUG4759_bw.jpg" alt="Sharing a quiet moment together"></div>

    <div class="border-cell middle-left" data-reveal-index="5"><img src="assets/images/AUG4849_bw.jpg" alt="Walking through the forest"></div>
    <div class="border-cell middle-left-lower" data-reveal-index="6"><img src="assets/images/AUG4869_bw.jpg" alt="Dancing together"></div>
    <main class="content-card">
      <div class="card-shell" id="cardShell">
        <div class="countdown-wrapper" aria-live="polite">
          <p class="eyebrow">Celebration Countdown</p>
          <div class="countdown-number" id="countdownNumber" role="status" aria-label="Countdown starting">10</div>
          <p class="countdown-note">Counting down the final moments until the big day.</p>
        </div>
      </div>
    </main>
    <div class="border-cell middle-right" data-reveal-index="7"><img src="assets/images/AUG5177_bw.jpg" alt="Laughing in the field"></div>
    <div class="border-cell middle-right-lower" data-reveal-index="8"><img src="assets/images/AUG5181_bw.jpg" alt="A spin in the meadow"></div>

    <div class="border-cell bottom-left" data-reveal-index="9"><img src="assets/images/AUG5106_bw.jpg" alt="Smiling under the trees"></div>
    <div class="border-cell bottom-left-center" data-reveal-index="10"><img src="assets/images/AUG5127_bw.jpg" alt="Holding close"></div>
    <div class="border-cell bottom-right-center" data-reveal-index="11"><img src="assets/images/AUG5139_bw.jpg" alt="Walking by the lake"></div>
    <div class="border-cell bottom-right" data-reveal-index="12"><img src="assets/images/AUG5201_bw.jpg" alt="Strolling along the shoreline"></div>
  </div>
  <script>
    const AudioContext = window.AudioContext || window.webkitAudioContext;
    const audioCtx = AudioContext ? new AudioContext() : null;

    const playBeat = () => {
      if (!audioCtx) return;
      if (audioCtx.state === 'suspended') {
        audioCtx.resume().catch(() => {});
      }

      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();
      osc.type = 'sine';
      osc.frequency.setValueAtTime(82, audioCtx.currentTime);
      osc.connect(gain);
      gain.connect(audioCtx.destination);

      const now = audioCtx.currentTime;
      gain.gain.setValueAtTime(0, now);
      gain.gain.linearRampToValueAtTime(1.3, now + 0.012);
      gain.gain.exponentialRampToValueAtTime(0.001, now + 0.34);
      osc.start(now);
      osc.stop(now + 0.34);
    };

    const borderCells = Array.from(document.querySelectorAll('.border-cell')).sort((first, second) => {
      const firstIndex = Number(first.dataset.revealIndex) || 0;
      const secondIndex = Number(second.dataset.revealIndex) || 0;
      return firstIndex - secondIndex;
    });

    const prefersReducedMotionQuery = typeof window.matchMedia === 'function'
      ? window.matchMedia('(prefers-reduced-motion: reduce)')
      : null;
    const prefersReducedMotion = prefersReducedMotionQuery?.matches ?? false;

    if (prefersReducedMotion) {
      borderCells.forEach((cell) => {
        cell.classList.add('is-visible');
      });
    }

    const cardShell = document.getElementById('cardShell');
    const initialCountdownWrapper = cardShell?.querySelector('.countdown-wrapper');
    const countdownNumber = document.getElementById('countdownNumber');
    const countdownNote = initialCountdownWrapper?.querySelector('.countdown-note');
    const countdownStart = borderCells.length > 0 ? borderCells.length : 10;
    let currentValue = countdownStart;
    let revealedCells = 0;
    let countdownIntervalId = null;
    let hasStarted = false;

    const startOverlay = document.getElementById('startOverlay');
    const startOverlayContent = startOverlay?.querySelector('.countdown-overlay-content') ?? null;
    const startButton = document.getElementById('startCountdownButton');

    const revealNextBorderCell = () => {
      if (prefersReducedMotion) {
        return;
      }

      const nextCell = borderCells[revealedCells];
      if (nextCell) {
        nextCell.classList.add('is-visible');
        revealedCells += 1;
      }
    };

    const showSaveTheDateDetails = () => {
      if (!cardShell) return;
      cardShell.innerHTML = '';

      const wrapper = document.createElement('div');
      wrapper.className = 'countdown-wrapper has-details';

      const eyebrow = document.createElement('p');
      eyebrow.className = 'eyebrow';
      eyebrow.textContent = 'Save the Date';

      const title = document.createElement('h1');
      title.className = 'save-date-title';
      title.innerHTML = '<span class="save-date-name">Lorraine</span>' +
        '<span class="save-date-amp">&amp;</span>' +
        '<span class="save-date-name">Christopher</span>';

      const dateLine = document.createElement('p');
      dateLine.className = 'save-date-date';
      dateLine.innerHTML = '<span class="save-date-date-main">September 12, 2026</span>' +
        '<span class="save-date-date-location">Portola, California</span>';

      const note = document.createElement('p');
      note.className = 'countdown-note save-date-note';
      note.textContent = 'Formal invite to follow';

      wrapper.appendChild(eyebrow);
      wrapper.appendChild(title);
      wrapper.appendChild(dateLine);
      wrapper.appendChild(note);

      cardShell.appendChild(wrapper);
    };

    const showCelebrationVideo = () => {
      if (!cardShell) return;
      cardShell.innerHTML = '';

      const wrapper = document.createElement('div');
      wrapper.className = 'countdown-wrapper has-video';

      const videoHashtag = document.createElement('p');
      videoHashtag.className = 'video-hashtag';
      videoHashtag.textContent = '#BECOMINGCUMMINGS';

      const videoFrame = document.createElement('div');
      videoFrame.className = 'countdown-video-frame';

      const celebrationVideo = document.createElement('video');
      celebrationVideo.className = 'countdown-video';
      celebrationVideo.src = 'assets/video.mp4';
      celebrationVideo.autoplay = true;
      celebrationVideo.muted = false;
      celebrationVideo.controls = true;
      celebrationVideo.setAttribute('playsinline', '');

      celebrationVideo.addEventListener('ended', () => {
        showSaveTheDateDetails();
      }, { once: true });

      celebrationVideo.addEventListener('error', () => {
        showSaveTheDateDetails();
      }, { once: true });

      videoFrame.appendChild(celebrationVideo);

      wrapper.appendChild(videoHashtag);
      wrapper.appendChild(videoFrame);

      cardShell.appendChild(wrapper);

      const attemptVideoPlayback = () => {
        const playPromise = celebrationVideo.play();
        if (playPromise && typeof playPromise.catch === 'function') {
          playPromise.catch(() => {});
        }
      };

      if (celebrationVideo.readyState >= 2) {
        attemptVideoPlayback();
      } else {
        celebrationVideo.addEventListener('canplay', attemptVideoPlayback, { once: true });
      }
    };
    const handleCountdownTick = () => {
      if (!countdownNumber) {
        return;
      }

      currentValue -= 1;
      countdownNumber.classList.add('is-transitioning');
      playBeat();

      if (currentValue <= 0) {
        countdownNumber.textContent = '0';
        countdownNumber.setAttribute('aria-label', 'Countdown finished');
        window.clearInterval(countdownIntervalId);
        revealNextBorderCell();
        if (countdownNote) {
          countdownNote.textContent = "It's time to celebrate!";
        }
        window.setTimeout(() => {
          showCelebrationVideo();
        }, 400);
      } else {
        countdownNumber.textContent = String(currentValue);
        countdownNumber.setAttribute('aria-label', `Countdown at ${currentValue}`);
        revealNextBorderCell();
      }

      window.setTimeout(() => {
        countdownNumber.classList.remove('is-transitioning');
      }, 360);
    };

    const startCountdownFlow = () => {
      if (!countdownNumber || !initialCountdownWrapper) {
        showCelebrationVideo();
        return;
      }

      countdownNumber.textContent = String(currentValue);
      countdownNumber.setAttribute('aria-label', `Countdown at ${currentValue}`);
      revealNextBorderCell();
      playBeat();
      countdownIntervalId = window.setInterval(handleCountdownTick, 1100);
    };

    const startExperience = () => {
      if (hasStarted) {
        return;
      }

      hasStarted = true;

      if (startOverlayContent) {
        startOverlayContent.classList.add('is-clearing');
      }

      if (startOverlay) {
        startOverlay.classList.add('is-counting');
        window.setTimeout(() => {
          startOverlay.classList.add('hidden');
        }, 420);
      }

      if (audioCtx && audioCtx.state === 'suspended') {
        audioCtx.resume().catch(() => {});
      }

      startCountdownFlow();
    };

    const handleOverlayKeyDown = (event) => {
      if (event.key === 'Enter' || event.key === ' ') {
        event.preventDefault();
        startExperience();
      }
    };

    if (startButton) {
      startButton.addEventListener('click', startExperience);
    }

    if (startOverlay) {
      startOverlay.addEventListener('click', startExperience);
      startOverlay.addEventListener('keydown', handleOverlayKeyDown);
    }

    if (!startOverlay || !startButton) {
      startExperience();
    }
  </script>
</body>
</html>
